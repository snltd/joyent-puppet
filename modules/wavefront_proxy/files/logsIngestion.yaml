---
aggregationIntervalSeconds: 5

counters:
  - pattern: '%{HOSTNAME:vhost} %{IPORHOST:clientip} - \[%{HTTPDATE:timestamp}\] "(?:%{WORD:verb} %{NOTSPACE:request}(?: HTTP/%{NUMBER:httpversion})?|%{DATA:rawrequest})" %{NUMBER:response} (?:%{NUMBER:bytes}|-) %{NOTSPACE:urt} %{NUMBER:rt}'
    metricName: 'nginx.code.%{response}'
    tagKeys:
      - vhost
      - path
    tagValueLabels:
      - vhost
      - request

histograms:
  - pattern: '%{HOSTNAME:vhost} %{IPORHOST:clientip} - \[%{HTTPDATE:timestamp}\] "(?:%{WORD:verb} %{NOTSPACE:request}(?: HTTP/%{NUMBER:httpversion})?|%{DATA:rawrequest})" %{NUMBER:response} (?:%{NUMBER:bytes}|-) %{NOTSPACE:urt} %{NUMBER:value}'
    metricName: 'nginx.time.response'
    tagKeys:
     - vhost
    tagValueLabels:
      - vhost
